---
layout:     post                    # 使用的布局（不需要改）
title:      服务器整体框架              # 标题 
subtitle:     #副标题
date:       2017-7-17              # 时间
author:     co                      # 作者
header-img: img/post-bg-2015.jpg    #这篇文章标题背景图片
catalog: true                       # 是否归档
tags:                               #标签
    - 架构
---
游戏服务器框架的架构有很多种。但是下面这种应该算是比较通用的。我们之前的游戏都有用过。这里可以认为是一个区的架构图。
> 为了不至于看上去太杂乱，图中有些线我没有画出来。


![](https://gitee.com/whatplane/resource/raw/master/img/xx_20190611183625.png)

暴露在公网的是登录服和网关
#### 登录服
客户端连接登录服，成功后，断开，再去连分配的网关。
#### 网关
客户端首先在登录服验证，通过后，会发送一个网关地址给客户端。那么这个网关服是怎么选择出来的呢。最简单的策略，根据网关上的承载人数，即选择一个最少人数的。每个网关启动后，都会上报信息给中心服。中心服可以认为是所有服务器的管理者。所以登录可以通过中心获取网关的承载信息。网关会开两个监听，主要接受客户端的连接和逻辑服务器的连接。网关的作用主要是转发消息。

#### 逻辑服
逻辑服就是我们的游戏服，处理各种游戏逻辑。比如是mmo类型的游戏，我们这里的逻辑服就是所谓的world。当然world还可以细分。比如可以划分为 聊天，场景，任务等等。一个网关可以连接至少一个world。每个world启动的时候，通过中心服，可以知道哪个网关负载比较少，则可以选择挂载在对应的网关上。
#### 数据服
数据服主要用来跟数据库打交道。其他逻辑服或者登录服都会连接数据服。我们这里数据服内部连接redis和mysql。游戏数据一般都是先存放到redis，之后通过定时器存放到mysql。

#### 管理服
主要存放玩家的session信息，和其他服务器的连接信息。同时提供http服务作为GM后台管理的支持
#### 公共服
这里比如可以做聊天，好友系统。因为涉及到多个world的交互。公共服会跟多个逻辑服连接。当然也可以有另外一种架构，把聊天服作为跟world平级的服务器，这样只要是聊天信息就直接发送给聊天服，也就不需要通过world再转发给聊天服了。
#### 总结 
服务间的通讯一般是sock长连接，当然可以通过http通讯，这个要看服务间交换的数据内容和频率。还有人也会直接通过redis作为消息队列来作为服务间的交互工具。架构可能有一些差别，但是我认为最重要的还是 稳定 可平行扩展。
#### 结束