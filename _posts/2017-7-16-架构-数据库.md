---
layout:     post                    # 使用的布局（不需要改）
title:      数据库              # 标题 
subtitle:     #副标题
date:       2017-7-17              # 时间
author:     co                      # 作者
header-img: img/post-bg-2015.jpg    #这篇文章标题背景图片
catalog: true                       # 是否归档
tags:                               #标签
    - 架构
---

一般来说游戏设计到数据库主要是两种 nosql和sql。典型的是redis和mysql。redis主要是实时保存游戏数据，mysql主要定时保存redis的数据。
#### redis
- redis是内存数据库，主要提供kv操作。redis提供数据类型主要有hash list set zset。一般我们在world中修改数据后保存到数据服，数据服会把数据写入到redis，当然同时会把数据缓存起来，加入到一个队列中，有专门的线程会定时把队列中的数据取出，然后写入到mysql。redis对于排名这些是有很好支持的。因为zset天然是有序集合。另外list可以作为队列使用。特别在多个服务作为生产者push数据到队列，一个服务器作为队列消费者的时候。

- 数据服启动的时候，一般也会创建一个redis连接池。因为redis是单线程架构，也就是redis服务是不断获取队列的命令来执行的，所以基本上多个连接同时使用不会有什么问题。
##### mysql
数据服启动的时候，一般会创建一个mysql连接池。也就是说一次性会跟mysql服务建立多个连接。当需要执行sql操作时，从mysqlpool中获得一个连接，发送sql命令即可。当然我们知道，mysql如果多个连接操作同一个数据，是可能会产生一个问题的。如果隔离级别设置太高，效率又可能跟不上。所以一个简单的方案是，我们的连接池中，可以指定哪个连接专门写数据，哪些连接专门读数据。这种分类可以具体根据游戏业务对数据库的表的划分来决定。当然更粗糙的方案是 就指定一个写连接，其他都是读连接。

#### 总结 

#### 结束