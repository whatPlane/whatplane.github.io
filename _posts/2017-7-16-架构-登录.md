---
layout:     post                    # 使用的布局（不需要改）
title:      登录              # 标题 
subtitle:     #副标题
date:       2017-7-17              # 时间
author:     co                      # 作者
header-img: img/post-bg-2015.jpg    #这篇文章标题背景图片
catalog: true                       # 是否归档
tags:                               #标签
    - 架构
---

登录一般有两种。
- 第三方登录

比如说手机游戏应用通过微信登录。客户端拉起微信登录授权界面，获取微信验证服务器的code，然后发送给自己的web服务器，web服务器再发送code给微信验证服务器，成功获取token，这样就算验证完成。之后通过微信服务器获取帐号信息，保存到自己的数据库，然后根据策略分配一个网关ip+port给客户端，客户端即可连接，开始游戏。

- 普通登录

我们连接登录服务器，登录服务器 通过 数据服务器 查询帐号密码。如果帐号不存在，那么创建一个新帐号。否则验证帐号密码是否正确。
> 数据服务器可以认为就是所有数据库访问的代理。当然，数据处理也可以分为两种类型 一种是专门处理帐号数据，另一种处理游戏数据。



#### 登录细节
普通登录时，验证过程一般分为主要两部
- 验证密钥
- 验证帐号密码

第一个过程一般设计到一些加密算法。主要流程如下
- s-c 服务器发送一个challenge给客户端
- c-s 客户端发送一个随机数clientkey
- s-c 发送一个serverkey给客户端。 同时利用交换算法，把clientkey+服务器自己的随机数，产生一个密钥secret1。
- c-s 利用交换算法，把serverkey+客户端自己随机的数，产生一个密钥secret2。然后发送secret2+challenge给服务器
- s-c 服务器比对 secret1 和 secret2 和 challage来确认验证是否成功。

第二个过程就是客户端发送帐号密码给登录服务器来验证。如果成功，那么一般登录服务器会发送一个token给游戏服务器，表示等下会有个拿token的客户端来登录，他是经过登录服验证了的。

#### 总结 

#### 结束