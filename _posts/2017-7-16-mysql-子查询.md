---
layout:     post                    # 使用的布局（不需要改）
title:      mysql-子查询              # 标题 
subtitle:     #副标题
date:       2018-3-17              # 时间
author:     co                      # 作者
header-img: img/post-bg-2015.jpg    #这篇文章标题背景图片
catalog: true                       # 是否归档
tags:                               #标签
    - mysql
---

实际上就是嵌套查询。一般子查询分为两种基本目的。一种是嵌套查询，一种是统计。写嵌套查询语句的时候，我们一般先假设一个怎么查，然后再分析一个集合怎么查。为了保证嵌套语句的正确性，一般我们先分开写sql来单独测试，然后嵌套。
我们还是以学生表和班级表举例。
```
MariaDB [test1]> select * from classes;
+----+--------+
| id | name   |
+----+--------+
|  1 | 一班   |
|  2 | 二班   |
|  3 | 三班   |
|  4 | 四班   |
+----+--------+
4 rows in set (0.00 sec)

MariaDB [test1]> select * from students;
+----+----------+--------+--------+-------+
| id | class_id | name   | gender | score |
+----+----------+--------+--------+-------+
|  1 |        1 | 小明   | M      |    90 |
|  2 |        1 | 小红   | F      |    95 |
|  3 |        1 | 小军   | M      |    88 |
|  4 |        1 | 小米   | F      |    83 |
|  5 |        2 | 小白   | F      |    81 |
|  6 |        2 | 小兵   | M      |    65 |
|  7 |        2 | 小林   | M      |    85 |
|  8 |        3 | 小新   | F      |    91 |
|  9 |        3 | 小王   | M      |    89 |
| 10 |        3 | 小丽   | F      |    85 |
| 11 |        5 | 新生   | M      |    88 |
+----+----------+--------+--------+-------+

```
#### 子查询 
我想查询班级表中所有班级的学生。注意 `where ... IN` 的搭配使用。
```
MariaDB [test1]> select * from students where class_id IN (
    -> select id from classes);
+----+----------+--------+--------+-------+
| id | class_id | name   | gender | score |
+----+----------+--------+--------+-------+
|  1 |        1 | 小明   | M      |    90 |
|  2 |        1 | 小红   | F      |    95 |
|  3 |        1 | 小军   | M      |    88 |
|  4 |        1 | 小米   | F      |    83 |
|  5 |        2 | 小白   | F      |    81 |
|  6 |        2 | 小兵   | M      |    65 |
|  7 |        2 | 小林   | M      |    85 |
|  8 |        3 | 小新   | F      |    91 |
|  9 |        3 | 小王   | M      |    89 |
| 10 |        3 | 小丽   | F      |    85 |
+----+----------+--------+--------+-------+
10 rows in set (0.00 sec)

```
当然也可以用 表连接。看下面sql语句.相比上面要麻烦多了
```
MariaDB [test1]> select s.id,s.class_id,s.name,s.gender,s.score from students s  inner join classes c on s.class_id=c.id;
+----+----------+--------+--------+-------+
| id | class_id | name   | gender | score |
+----+----------+--------+--------+-------+
|  1 |        1 | 小明   | M      |    90 |
|  2 |        1 | 小红   | F      |    95 |
|  3 |        1 | 小军   | M      |    88 |
|  4 |        1 | 小米   | F      |    83 |
|  5 |        2 | 小白   | F      |    81 |
|  6 |        2 | 小兵   | M      |    65 |
|  7 |        2 | 小林   | M      |    85 |
|  8 |        3 | 小新   | F      |    91 |
|  9 |        3 | 小王   | M      |    89 |
| 10 |        3 | 小丽   | F      |    85 |
+----+----------+--------+--------+-------+
10 rows in set (0.00 sec)

```
#### 统计
我们按照班级表，统计每个班的学生个数。先找出班级集合，然后针对每个班级做统计
```
MariaDB [test1]> 
	select id,name,
	(select count(1) from students where classes.id=students.class_id ) as count 
	from classes;  
+----+--------+-------+
| id | name   | count |
+----+--------+-------+
|  1 | 一班   |     4 |
|  2 | 二班   |     3 |
|  3 | 三班   |     3 |
|  4 | 四班   |     0 |
+----+--------+-------+
4 rows in set (0.00 sec)

```
这里是把统计作为一个 列，展示出来。
### 结束