---
layout:     post                    # 使用的布局（不需要改）
title:      mysql-查询              # 标题 
subtitle:     #副标题
date:       2018-3-17              # 时间
author:     co                      # 作者
header-img: img/post-bg-2015.jpg    #这篇文章标题背景图片
catalog: true                       # 是否归档
tags:                               #标签
    - mysql
---
讨论是以下面两张表作为基础.也就是students表和classes表。
```
Database changed
MariaDB [test1]> show tables;
+-----------------+
| Tables_in_test1 |
+-----------------+
| classes         |
| students        |
+-----------------+
2 rows in set (0.00 sec)

MariaDB [test1]> select * from students;
+----+----------+--------+--------+-------+
| id | class_id | name   | gender | score |
+----+----------+--------+--------+-------+
|  1 |        1 | 小明   | M      |    90 |
|  2 |        1 | 小红   | F      |    95 |
|  3 |        1 | 小军   | M      |    88 |
|  4 |        1 | 小米   | F      |    73 |
|  5 |        2 | 小白   | F      |    81 |
|  6 |        2 | 小兵   | M      |    55 |
|  7 |        2 | 小林   | M      |    85 |
|  8 |        3 | 小新   | F      |    91 |
|  9 |        3 | 小王   | M      |    89 |
| 10 |        3 | 小丽   | F      |    85 |
+----+----------+--------+--------+-------+
10 rows in set (0.00 sec)

MariaDB [test1]> select * from classes;
+----+--------+
| id | name   |
+----+--------+
|  1 | 一班   |
|  2 | 二班   |
|  3 | 三班   |
|  4 | 四班   |
+----+--------+
4 rows in set (0.00 sec)

```
#### 基本查询
```
select * from students;
```

#### 条件查询
查出 一班 的所有学生信息。
```
MariaDB [test1]> select * from students where class_id=1;
+----+----------+--------+--------+-------+
| id | class_id | name   | gender | score |
+----+----------+--------+--------+-------+
|  1 |        1 | 小明   | M      |    90 |
|  2 |        1 | 小红   | F      |    95 |
|  3 |        1 | 小军   | M      |    88 |
|  4 |        1 | 小米   | F      |    73 |
+----+----------+--------+--------+-------+
4 rows in set (0.00 sec)

```
查询不是一班的学生记录.注意里面使用了 not 关键字 in 关键字 <>不等于操作符
```
MariaDB [test1]> select * from students where not class_id=1;
+----+----------+--------+--------+-------+
| id | class_id | name   | gender | score |
+----+----------+--------+--------+-------+
|  5 |        2 | 小白   | F      |    81 |
|  6 |        2 | 小兵   | M      |    55 |
|  7 |        2 | 小林   | M      |    85 |
|  8 |        3 | 小新   | F      |    91 |
|  9 |        3 | 小王   | M      |    89 |
| 10 |        3 | 小丽   | F      |    85 |
+----+----------+--------+--------+-------+
6 rows in set (0.00 sec)

MariaDB [test1]> select * from students where class_id<>1;
+----+----------+--------+--------+-------+
| id | class_id | name   | gender | score |
+----+----------+--------+--------+-------+
|  5 |        2 | 小白   | F      |    81 |
|  6 |        2 | 小兵   | M      |    55 |
|  7 |        2 | 小林   | M      |    85 |
|  8 |        3 | 小新   | F      |    91 |
|  9 |        3 | 小王   | M      |    89 |
| 10 |        3 | 小丽   | F      |    85 |
+----+----------+--------+--------+-------+
6 rows in set (0.00 sec)

MariaDB [test1]> select * from students where class_id in(2,3);
+----+----------+--------+--------+-------+
| id | class_id | name   | gender | score |
+----+----------+--------+--------+-------+
|  5 |        2 | 小白   | F      |    81 |
|  6 |        2 | 小兵   | M      |    55 |
|  7 |        2 | 小林   | M      |    85 |
|  8 |        3 | 小新   | F      |    91 |
|  9 |        3 | 小王   | M      |    89 |
| 10 |        3 | 小丽   | F      |    85 |
+----+----------+--------+--------+-------+
6 rows in set (0.00 sec)

```

条件查询经常用到 AND OR NOT in 。一般来说为了逻辑清晰用括号表明他们的优先级。
#### 投影查询
上面的查询是展示所有的列数据，投影查询是指选择指定的列显示。比如只显示学生的名字和分数
```
MariaDB [test1]> select name,score from students ;
+--------+-------+
| name   | score |
+--------+-------+
| 小明   |    90 |
| 小红   |    95 |
| 小军   |    88 |
| 小米   |    73 |
| 小白   |    81 |
| 小兵   |    55 |
| 小林   |    85 |
| 小新   |    91 |
| 小王   |    89 |
| 小丽   |    85 |
+--------+-------+
10 rows in set (0.00 sec)

```

#### 排序
我们一般查询的结果都是按照id这个主键来排列的（create的students表的时候，设置了id为主键）。如果想按照学生分数来排序呢。
```
MariaDB [test1]> select * from students order by score ;
+----+----------+--------+--------+-------+
| id | class_id | name   | gender | score |
+----+----------+--------+--------+-------+
|  6 |        2 | 小兵   | M      |    55 |
|  4 |        1 | 小米   | F      |    73 |
|  5 |        2 | 小白   | F      |    81 |
|  7 |        2 | 小林   | M      |    85 |
| 10 |        3 | 小丽   | F      |    85 |
|  3 |        1 | 小军   | M      |    88 |
|  9 |        3 | 小王   | M      |    89 |
|  1 |        1 | 小明   | M      |    90 |
|  8 |        3 | 小新   | F      |    91 |
|  2 |        1 | 小红   | F      |    95 |
+----+----------+--------+--------+-------+
10 rows in set (0.00 sec)

```
我们看到是按照从小到大的顺序排列的。如果想按照从大到小排序呢。看下面
```
MariaDB [test1]> select * from students order by score DESC ;
+----+----------+--------+--------+-------+
| id | class_id | name   | gender | score |
+----+----------+--------+--------+-------+
|  2 |        1 | 小红   | F      |    95 |
|  8 |        3 | 小新   | F      |    91 |
|  1 |        1 | 小明   | M      |    90 |
|  9 |        3 | 小王   | M      |    89 |
|  3 |        1 | 小军   | M      |    88 |
|  7 |        2 | 小林   | M      |    85 |
| 10 |        3 | 小丽   | F      |    85 |
|  5 |        2 | 小白   | F      |    81 |
|  4 |        1 | 小米   | F      |    73 |
|  6 |        2 | 小兵   | M      |    55 |
+----+----------+--------+--------+-------+

```
实际上按照升序排列是 ASC ，如果按照降序排列就是 DESC。只是默认是升序，所以可以省略ASC关键字。如果我们想先按照性别排序，然后按照分数降序排列呢。看下面
```
MariaDB [test1]> select * from students order by gender ASC,score DESC ;
+----+----------+--------+--------+-------+
| id | class_id | name   | gender | score |
+----+----------+--------+--------+-------+
|  2 |        1 | 小红   | F      |    95 |
|  8 |        3 | 小新   | F      |    91 |
| 10 |        3 | 小丽   | F      |    85 |
|  5 |        2 | 小白   | F      |    81 |
|  4 |        1 | 小米   | F      |    73 |
|  1 |        1 | 小明   | M      |    90 |
|  9 |        3 | 小王   | M      |    89 |
|  3 |        1 | 小军   | M      |    88 |
|  7 |        2 | 小林   | M      |    85 |
|  6 |        2 | 小兵   | M      |    55 |
+----+----------+--------+--------+-------+
10 rows in set (0.00 sec)

```
也就是说 order by 后面 可以利用多个字段来划分，注意每个字段可以单独表明是升序还是降序。
#### 分页查询（范围查询）
如果记录很多，我只想查看指定范围的记录。`LIMIT M OFFSET N`表示从N行开始（包括第N行，mysql是从0开始索引的），最多取M条记录。
```
-- 我们先看看所有的成绩排序
MariaDB [test1]> select name ,score from students order by score DESC ;
+--------+-------+
| name   | score |
+--------+-------+
| 小红   |    95 |
| 小新   |    91 |
| 小明   |    90 |
| 小王   |    89 |
| 小军   |    88 |
| 小林   |    85 |
| 小丽   |    85 |
| 小白   |    81 |
| 小米   |    73 |
| 小兵   |    55 |
+--------+-------+
10 rows in set (0.00 sec)

-- 看前三名
MariaDB [test1]> select name ,score from students order by score DESC limit 3 offset 0 ;
+--------+-------+
| name   | score |
+--------+-------+
| 小红   |    95 |
| 小新   |    91 |
| 小明   |    90 |
+--------+-------+
3 rows in set (0.00 sec)
 -- 看第四名到第八名
MariaDB [test1]> select name ,score from students order by score DESC limit 4 offset 3 ;
+--------+-------+
| name   | score |
+--------+-------+
| 小王   |    89 |
| 小军   |    88 |
| 小林   |    85 |
| 小丽   |    85 |
+--------+-------+

```
#### 多表查询
```
select * from students , classes;

MariaDB [test1]> select * from students,classes;
+----+----------+--------+--------+-------+----+--------+
| id | class_id | name   | gender | score | id | name   |
+----+----------+--------+--------+-------+----+--------+
|  1 |        1 | 小明   | M      |    90 |  1 | 一班   |
|  1 |        1 | 小明   | M      |    90 |  2 | 二班   |
|  1 |        1 | 小明   | M      |    90 |  3 | 三班   |
|  1 |        1 | 小明   | M      |    90 |  4 | 四班   |
|  2 |        1 | 小红   | F      |    95 |  1 | 一班   |
|  2 |        1 | 小红   | F      |    95 |  2 | 二班   |
|  2 |        1 | 小红   | F      |    95 |  3 | 三班   |
|  2 |        1 | 小红   | F      |    95 |  4 | 四班   |
|  3 |        1 | 小军   | M      |    88 |  1 | 一班   |
|  3 |        1 | 小军   | M      |    88 |  2 | 二班   |
|  3 |        1 | 小军   | M      |    88 |  3 | 三班   |
|  3 |        1 | 小军   | M      |    88 |  4 | 四班   |
|  4 |        1 | 小米   | F      |    73 |  1 | 一班   |
|  4 |        1 | 小米   | F      |    73 |  2 | 二班   |
|  4 |        1 | 小米   | F      |    73 |  3 | 三班   |
|  4 |        1 | 小米   | F      |    73 |  4 | 四班   |
|  5 |        2 | 小白   | F      |    81 |  1 | 一班   |
|  5 |        2 | 小白   | F      |    81 |  2 | 二班   |
|  5 |        2 | 小白   | F      |    81 |  3 | 三班   |
|  5 |        2 | 小白   | F      |    81 |  4 | 四班   |
|  6 |        2 | 小兵   | M      |    55 |  1 | 一班   |
|  6 |        2 | 小兵   | M      |    55 |  2 | 二班   |
|  6 |        2 | 小兵   | M      |    55 |  3 | 三班   |
|  6 |        2 | 小兵   | M      |    55 |  4 | 四班   |
|  7 |        2 | 小林   | M      |    85 |  1 | 一班   |
|  7 |        2 | 小林   | M      |    85 |  2 | 二班   |
|  7 |        2 | 小林   | M      |    85 |  3 | 三班   |
|  7 |        2 | 小林   | M      |    85 |  4 | 四班   |
|  8 |        3 | 小新   | F      |    91 |  1 | 一班   |
|  8 |        3 | 小新   | F      |    91 |  2 | 二班   |
|  8 |        3 | 小新   | F      |    91 |  3 | 三班   |
|  8 |        3 | 小新   | F      |    91 |  4 | 四班   |
|  9 |        3 | 小王   | M      |    89 |  1 | 一班   |
|  9 |        3 | 小王   | M      |    89 |  2 | 二班   |
|  9 |        3 | 小王   | M      |    89 |  3 | 三班   |
|  9 |        3 | 小王   | M      |    89 |  4 | 四班   |
| 10 |        3 | 小丽   | F      |    85 |  1 | 一班   |
| 10 |        3 | 小丽   | F      |    85 |  2 | 二班   |
| 10 |        3 | 小丽   | F      |    85 |  3 | 三班   |
| 10 |        3 | 小丽   | F      |    85 |  4 | 四班   |
+----+----------+--------+--------+-------+----+--------+
40 rows in set (0.00 sec)


```
上面得到的是 班级表记录数 x 学生表记录数 。而且 列中出现了两个id。也就是无法区分是学生表的id还是班级表的id。当然也出现了两个name列。所以可以明确一点像下面这样

```
-- 下面给列取了别名
-- select 列 别名 ，列 别名 from table,table

MariaDB [test1]> select classes.id cid,classes.name cname ,students.id sid,students.name sname from students,classes;
+-----+--------+-----+--------+
| cid | cname  | sid | sname  |
+-----+--------+-----+--------+
|   1 | 一班   |   1 | 小明   |
|   2 | 二班   |   1 | 小明   |
|   3 | 三班   |   1 | 小明   |
|   4 | 四班   |   1 | 小明   |
|   1 | 一班   |   2 | 小红   |
|   2 | 二班   |   2 | 小红   |
|   3 | 三班   |   2 | 小红   |
|   4 | 四班   |   2 | 小红   |
|   1 | 一班   |   3 | 小军   |
...

```
当然还可以进一步简化一点.像下面这样，先给学生表和班级表取一个别名
```
MariaDB [test1]> select c.id cid,c.name cname ,s.id sid,s.name sname from students s,classes c;
+-----+--------+-----+--------+
| cid | cname  | sid | sname  |
+-----+--------+-----+--------+
|   1 | 一班   |   1 | 小明   |
|   2 | 二班   |   1 | 小明   |
|   3 | 三班   |   1 | 小明   |
|   4 | 四班   |   1 | 小明   |
|   1 | 一班   |   2 | 小红   |
|   2 | 二班   |   2 | 小红   |
|   3 | 三班   |   2 | 小红   |

```
查找学生记录 x 一班级 ，注意区别于 `一班的学生记录`.下面的查询出现的是 10条记录。
```
MariaDB [test1]> select c.name cname ,s.id sid,s.name sname,s.gender sex from students s,classes c where c.id=1 ;
+--------+-----+--------+-----+
| cname  | sid | sname  | sex |
+--------+-----+--------+-----+
| 一班   |   1 | 小明   | M   |
| 一班   |   2 | 小红   | F   |
| 一班   |   3 | 小军   | M   |
| 一班   |   4 | 小米   | F   |
| 一班   |   5 | 小白   | F   |
| 一班   |   6 | 小兵   | M   |
| 一班   |   7 | 小林   | M   |
| 一班   |   8 | 小新   | F   |
| 一班   |   9 | 小王   | M   |
| 一班   |  10 | 小丽   | F   |
+--------+-----+--------+-----+
10 rows in set (0.00 sec)


```
#### 连接多表 
连接查询跟上面的多表查询区别是，连接查询有个主表结果集，然后再把其他表的记录连接到主表结果集。这里注意类比交集并集的概念。
我们 查找 `一班的学生记录(包括班级信息)`

```
MariaDB [test1]> select c.name cname, s.name sname ,s.gender sex 
	from students s 
	inner join classes c 
	on c.id=1 AND s.class_id=1;

+--------+--------+-----+
| cname  | sname  | sex |
+--------+--------+-----+
| 一班   | 小明   | M   |
| 一班   | 小红   | F   |
| 一班   | 小军   | M   |
| 一班   | 小米   | F   |
+--------+--------+-----+
4 rows in set (0.00 sec)

```

注意INNER JOIN查询的写法是：

- 先确定主表，仍然使用FROM <表1>的语法；
- 再确定需要连接的表，使用INNER JOIN <表2>的语法；
- 然后确定连接条件，使用ON <条件...>，这里的条件是s.class_id = c.id，表示students表的class_id列与classes表的id列相同的行需要连接；
- 可选：加上WHERE子句、ORDER BY等子句。

![](https://gitee.com/whatplane/resource/raw/master/img/join-min.PNG)

我们在来看看学生表和班级表。学生表中class_id为 1 2 3 5 四个班级。班级表有id为 1 2 3 4的四个班级
```
MariaDB [test1]> select * from students;
+----+----------+--------+--------+-------+
| id | class_id | name   | gender | score |
+----+----------+--------+--------+-------+
|  1 |        1 | 小明   | M      |    90 |
|  2 |        1 | 小红   | F      |    95 |
|  3 |        1 | 小军   | M      |    88 |
|  4 |        1 | 小米   | F      |    73 |
|  5 |        2 | 小白   | F      |    81 |
|  6 |        2 | 小兵   | M      |    55 |
|  7 |        2 | 小林   | M      |    85 |
|  8 |        3 | 小新   | F      |    91 |
|  9 |        3 | 小王   | M      |    89 |
| 10 |        3 | 小丽   | F      |    85 |
| 11 |        5 | 新生   | M      |    88 | -- 这个学生是5班的，但是班级表中没有5班的记录
+----+----------+--------+--------+-------+
11 rows in set (0.00 sec)

MariaDB [test1]> select * from classes;
+----+--------+
| id | name   |
+----+--------+
|  1 | 一班   |
|  2 | 二班   |
|  3 | 三班   |
|  4 | 四班   |
+----+--------+
4 rows in set (0.00 sec)

```
right outer join
```
MariaDB [test1]> select s.name sname,s.score score ,c.name cname from students s right outer join classes c on c.id=s.class_id;
+--------+-------+--------+
| sname  | score | cname  |
+--------+-------+--------+
| 小明   |    90 | 一班   |
| 小红   |    95 | 一班   |
| 小军   |    88 | 一班   |
| 小米   |    73 | 一班   |
| 小白   |    81 | 二班   |
| 小兵   |    55 | 二班   |
| 小林   |    85 | 二班   |
| 小新   |    91 | 三班   |
| 小王   |    89 | 三班   |
| 小丽   |    85 | 三班   |
| NULL   |  NULL | 四班   | -- 这里的学生表记录为空
+--------+-------+--------+
11 rows in set (0.00 sec)

```
left outer join
```
MariaDB [test1]> select s.name sname,s.score score ,c.name cname from students s left outer join classes c on c.id=s.class_id;
+--------+-------+--------+
| sname  | score | cname  |
+--------+-------+--------+
| 小明   |    90 | 一班   |
| 小红   |    95 | 一班   |
| 小军   |    88 | 一班   |
| 小米   |    73 | 一班   |
| 小白   |    81 | 二班   |
| 小兵   |    55 | 二班   |
| 小林   |    85 | 二班   |
| 小新   |    91 | 三班   |
| 小王   |    89 | 三班   |
| 小丽   |    85 | 三班   |
| 新生   |    88 | NULL   | -- 注意这里班级名字为 空
+--------+-------+--------+
11 rows in set (0.00 sec)

```
full outer join mysql不支持
```

```
### 结束